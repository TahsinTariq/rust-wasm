name: Build and Deploy
on:
  push:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v2.3.1

      - name: Install and Build üîß
        run: |
            rustup target add wasm32-unknown-unknown
            curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
            source ~/.nvm/nvm.sh
            nvm install 10
            curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
            mkdir -p docs
            # for d in * ; do
            # if "$d" != "docs"
            # then
            # echo "current dir: $pwd lopping dir: $d"
            # cd $d && wasm-pack build
            # cd www && npm install
            # npm run build
            # mkdir ../../docs/$d
            # mv ./dist/* ../../docs/$d
            # cd ../../
            # fi
            # done
            docs="docs"
            for d in * ; do
            if [[ "$d" != "$docs" ]]; then
            echo "current dir: $pwd lopping dir: $d"
            cd $d && wasm-pack build
            cd www && npm install
            npm run build
            mkdir ../../docs/$d
            mv ./dist/* ../../docs/$d
            cd ../../
            fi
            done

            # cd game-of-life && wasm-pack build
            # cd www && npm install
            # npm run build
            # mkdir ../../docs/game
            # mv ./dist/* ../../docs/game

      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@4.1.4
        with:
          branch: gh-pages # The branch the action should deploy to.
          folder: docs # The folder the action should deploy.
